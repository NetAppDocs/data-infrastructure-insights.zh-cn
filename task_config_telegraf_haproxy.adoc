---
sidebar: sidebar 
permalink: task_config_telegraf_haproxy.html 
keywords: telegraf, installation, install, haproxy 
summary: HAProxy 数据收集器配置 
---
= HAProxy 数据收集器
:hardbreaks:
:allow-uri-read: 


[role="lead"]
Data Infrastructure Insights使用此数据收集器从 HAProxy 收集指标。



== 安装

. 从*可观察性 > 收集器*中，单击*+数据收集器*。选择 HAProxy。
+
选择安装 Telegraf 代理的操作系统或平台。

. 如果您尚未安装用于收集的代理，或者您希望为不同的操作系统或平台安装代理，请单击“显示说明”以展开link:task_config_telegraf_agent.html["代理安装"]指示。
. 选择用于此数据收集器的代理访问密钥。您可以通过单击 *+ 代理访问密钥* 按钮添加新的代理访问密钥。最佳实践：仅当您想要对数据收集器进行分组（例如按操作系统/平台）时才使用不同的代理访问密钥。
. 按照配置步骤配置数据收集器。说明根据您用于收集数据的操作系统或平台的类型而有所不同。


image:HAProxyDCConfigLinux.png["HAProxy 配置"]



== 设置

Telegraf 的 HAProxy 插件依赖于 HAProxy Stats 的支持。这是 HAProxy 内置的配置，但它并非开箱即用。启用后，HAProxy 将公开一个 HTML 端点，您可以在浏览器上查看该端点，也可以抓取该端点以提取所有 HAProxy 配置的状态。



=== 兼容性：

配置是针对 HAProxy 版本 1.9.4 开发的。



=== 设置：

要启用统计信息，请编辑您的 haproxy 配置文件并在“默认”部分后添加以下行，使用您自己的用户/密码和/或 haproxy URL：

[listing]
----
stats enable
stats auth myuser:mypassword
stats uri  /haproxy?stats
----
以下是启用统计信息的简化示例配置文件：

[listing]
----
global
  daemon
  maxconn 256

defaults
  mode http
  stats enable
  stats uri /haproxy?stats
  stats auth myuser:mypassword
  timeout connect 5000ms
  timeout client 50000ms
  timeout server 50000ms

frontend http-in
  bind *:80
  default_backend servers

frontend http-in9080
  bind *:9080
  default_backend servers_2

backend servers
  server server1 10.128.0.55:8080 check ssl verify none
  server server2 10.128.0.56:8080 check ssl verify none

backend servers_2
  server server3 10.128.0.57:8080 check ssl verify none
  server server4 10.128.0.58:8080 check ssl verify none
----
有关完整和最新的说明，请参阅link:https://cbonte.github.io/haproxy-dconv/1.8/configuration.html#4-stats%20enable["HAProxy 文档"]。



== 物体和计数器

收集以下对象及其计数器：

[cols="<.<,<.<,<.<,<.<"]
|===
| 目的： | 标识符： | 属性： | 数据点： 


| HAProxy 前端 | 命名空间地址代理 | 节点 IP 节点名称 代理 ID 模式 进程 ID 会话速率限制 服务器 ID 会话限制状态 | 传入字节数 传出字节数 缓存命中数 缓存查找数 压缩 绕过的字节数 传入压缩 传出字节数 压缩响应数 连接速率 连接速率 最大连接数 连接规则拒绝的请求总数 出于安全考虑拒绝的请求数 出于安全考虑拒绝的响应 会话规则拒绝的请求数 请求错误 响应 1xx 响应 2xx 响应 3xx 响应 4xx 响应 5xx 响应 其他请求 拦截的会话速率 会话速率 最大请求速率 请求速率 最大请求速率 总会话数 会话数 最大会话数 总请求数 重写 


| HAProxy 服务器 | 命名空间地址代理服务器 | 节点IP 节点名称 检查完成时间 检查下降配置 检查健康值 检查上升配置 检查状态 代理ID 上次更改时间 上次会话时间 模式 进程ID 服务器ID 状态权重 | 活动服务器 备份服务器 输入字节数 输出字节数 检查停机数 检查失败数 客户端中止连接数 连接平均时间 停机时间 拒绝响应总数 连接错误数 响应错误数 响应 1xx 数 响应 2xx 数 响应 3xx 数 响应 4xx 数 响应 5xx 数 响应 其他选定服务器 总计 队列 当前队列 最大队列 平均时间 每秒会话数 每秒会话数 最大连接重用数 响应时间 平均会话数 最大会话数 服务器传输中止数 会话总数 会话总数 总时间 平均请求数 重新分派数 请求数 重试数 请求数 重写数 


| HAProxy 后端 | 命名空间地址代理 | 节点IP 节点名称 代理ID 上次更改时间 上次会话时间 模式 进程ID 服务器ID 会话限制 状态 权重 | 活动服务器 备份服务器 传入字节数 传出字节数 缓存命中数 缓存查找数 检查失败数 客户端中止数 压缩 绕过的字节数 压缩传入字节数 压缩传出字节数 压缩响应数 连接数 连接平均时间 停机时间 因安全问题拒绝的请求总数 因安全问题拒绝的响应数 连接错误数 响应错误数 1xx 响应数 2xx 响应数 3xx 响应数 4xx 响应数 5xx 响应数 选定的其他服务器 总计 队列数 当前队列数 最大队列数 平均时间 每秒会话数 每秒会话数 最大请求数 总连接重用数 响应时间 平均会话数 最大会话数 服务器传输中止数 会话数 会话总数 总时间 平均请求数 重新分派数 请求数 重试数 请求数 重写数 
|===


== 故障排除

更多信息可从link:concept_requesting_support.html["支持"]页。
